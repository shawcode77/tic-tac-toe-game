<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>‰∫ïÂ≠óÊ£ãÂ∞èÊ∏∏Êàè</title>
<style>
body {
  font-family: Arial, sans-serif;
  display: flex;
  flex-direction: column;
  align-items: center;
  min-height: 100vh;
  margin: 0;
  background: #f0f0f0;
  padding: 20px;
}
h1 {
  margin: 0 0 10px 0;
  font-size: clamp(22px, 6vw, 36px);
  font-weight: 800;
  display: flex;
  gap: 6px;
  user-select: none;
}
h1 span:nth-child(1){ color:#ff5a5a; }
h1 span:nth-child(2){ color:#ff9800; }
h1 span:nth-child(3){ color:#43a047; }
h1 span:nth-child(4){ color:#2196f3; }
h1 span:nth-child(5){ color:#ab47bc; }
h1 span:nth-child(6){ color:#e91e63; }

#modeBtn {
  margin: 10px 0;
  padding: 8px 18px;
  border: none;
  border-radius: 20px;
  background: #007bff;
  color: white;
  cursor: pointer;
  font-size: 14px;
}
#modeBtn:hover { background: #0056b3; }

.scoreboard {
  display: flex;
  justify-content: center;
  gap: 20px;
  margin: 10px 0;
}
.score-card {
  display: flex;
  justify-content: space-between;
  align-items: center;
  width: 100px;
  padding: 8px 12px;
  border-radius: 12px;
  background: #fff;
  box-shadow: 0 2px 6px rgba(0,0,0,0.15);
  cursor: pointer;
  transition: transform 0.2s, box-shadow 0.2s;
  font-weight: bold;
  font-size: 16px;
}
.score-card.active {
  box-shadow: 0 4px 12px rgba(0,0,0,0.3);
  transform: scale(1.05);
}
.score-symbol.X { color:#d32f2f; font-size:18px; }
.score-symbol.O { color:#1976d2; font-size:18px; }
.score-value { min-width: 18px; text-align: right; }

#statusMessage {
  margin: 6px 0;
  font-size: 14px;
  color: #555;
  min-height: 1.2em;
}

#board {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 6px;
  width: 75vw;
  max-width: 320px;
  aspect-ratio: 1 / 1;
  background: #fff;
  padding: 10px;
  border-radius: 16px;
  box-shadow: 0 6px 18px rgba(0,0,0,0.22);
  margin-top: 10px;
}
.cell {
  background: #fafafa;
  border: 2px solid #333;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: clamp(24px, 7vw, 48px);
  font-weight: 800;
  cursor: pointer;
  border-radius: 10px;
  transition: background 0.2s, transform 0.1s;
  user-select: none;
  aspect-ratio: 1 / 1;
}
.cell:hover { background: #e6f2ff; transform: scale(1.05); }

/* Áº©ÊîæÂä®Áîª */
@keyframes popIn {
  from { transform: scale(0.3); }
  to   { transform: scale(1); }
}

.cell.X { color: #d32f2f; }
.cell.O { color: #1976d2; }
.win { background: #90ee90 !important; }

#message {
  margin-top: 12px;
  font-size: clamp(14px, 4.5vw, 22px);
  font-weight: bold;
  text-align: center;
  min-height: 1.2em;
}

#resetBtn {
  margin-top: 14px;
  padding: 10px 20px;
  font-size: clamp(14px, 4vw, 18px);
  border: none;
  border-radius: 26px;
  background: #007bff;
  color: #fff;
  cursor: pointer;
}
#resetBtn:hover { background: #0056b3; }
</style>
</head>
<body>
<h1>
  <span>‰∫ï</span><span>Â≠ó</span><span>Ê£ã</span><span>Â∞è</span><span>Ê∏∏</span><span>Êàè</span>
</h1>

<button id="modeBtn">Ê®°ÂºèÔºö‰∫∫Êú∫ÂØπÊàò</button>

<div class="scoreboard">
  <div class="score-card active" data-player="X">
    <div class="score-symbol X">X</div>
    <div class="score-value" id="scoreX">-</div>
  </div>
  <div class="score-card" data-player="O">
    <div class="score-symbol O">O</div>
    <div class="score-value" id="scoreO">-</div>
  </div>
</div>
<div id="statusMessage">ÂºÄÂßãÊ∏∏ÊàèÊàñÈÄâÊã©Áé©ÂÆ∂</div>

<div id="board"></div>
<div id="message"></div>
<button id="resetBtn">ÈáçÊñ∞ÂºÄÂßã</button>

<script>
const board = document.getElementById('board');
const message = document.getElementById('message');
const resetBtn = document.getElementById('resetBtn');
const modeBtn = document.getElementById('modeBtn');
const scoreXEl = document.getElementById('scoreX');
const scoreOEl = document.getElementById('scoreO');
const scoreCards = document.querySelectorAll('.score-card');
const statusMessage = document.getElementById('statusMessage');

let currentPlayer = 'X';
let cells = [];
let isVsAI = true;
let humanPlayer = 'X';
let aiPlayer = 'O';
let scores = { X: 0, O: 0 };
let gameActive = false;
let firstMove = true;

const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
document.addEventListener('click', () => {
  if (audioCtx.state === 'suspended') audioCtx.resume();
}, { once: true });

function playTone(frequency, type="square", duration=0.2, volume=0.2, delay=0){
  const now = audioCtx.currentTime + delay;
  const osc = audioCtx.createOscillator();
  const gain = audioCtx.createGain();
  osc.type = type; osc.frequency.setValueAtTime(frequency, now);
  gain.gain.setValueAtTime(volume, now);
  osc.connect(gain); gain.connect(audioCtx.destination);
  osc.start(now); osc.stop(now + duration);
}
function playMoveSound(p){ p==='X' ? playTone(1000) : playTone(750); }
function playWinSound(){ playTone(600,"triangle",0.2,0.3); playTone(800,"triangle",0.2,0.3,0.25); playTone(1000,"triangle",0.3,0.3,0.5); }
function playDrawSound(){ playTone(500,"sine",0.3,0.25); playTone(300,"sine",0.3,0.25,0.3); }

function createBoard() {
  board.innerHTML = '';
  cells = [];
  message.textContent = '';
  message.style.color = '#444';
  message.style.fontStyle = 'normal';
  currentPlayer = 'X';
  gameActive = true;
  firstMove = true;

  for (let i=0; i<9; i++) {
    const cell = document.createElement('button');
    cell.classList.add('cell');
    cell.addEventListener('click', () => handleMove(cell));
    board.appendChild(cell);
    cells.push(cell);
  }

  updateScores();

  if (isVsAI) {
    statusMessage.textContent = "ÂºÄÂßãÊ∏∏ÊàèÊàñÈÄâÊã©Áé©ÂÆ∂";
    if (aiPlayer==='X') setTimeout(aiMove, 500);
  } else {
    statusMessage.textContent = "ÂΩìÂâçËΩÆÂà∞ " + currentPlayer;
    updateTurnUI();
  }
}

function handleMove(cell) {
  if (!gameActive) return;
  if (cell.textContent!=='' || message.textContent!=='') return;

  if (firstMove) firstMove = false;

  cell.textContent = currentPlayer;
  cell.classList.add(currentPlayer);

  // Áº©ÊîæÂä®Áîª
  cell.style.animation = "none";
  cell.offsetHeight;
  cell.style.animation = "popIn 0.25s ease-out";

  playMoveSound(currentPlayer);

  const winPattern = checkWin(currentPlayer);
  if (winPattern) {
    disableBoard();
    playWinSound();
    scores[currentPlayer] += 1;
    updateScores();
    highlightWin(winPattern);
    gameActive = false;

    if(currentPlayer==='X'){
      message.style.color = '#d32f2f';
      message.style.fontStyle = 'normal';
      message.textContent = 'X Ëµ¢‰∫ÜÔºÅ üéâ';
    } else {
      message.style.color = '#1976d2';
      message.style.fontStyle = 'normal';
      message.textContent = 'O Ëµ¢‰∫ÜÔºÅ üéâ';
    }
    return;
  } else if (cells.every(c=>c.textContent!=='')) {
    playDrawSound();
    gameActive = false;
    message.style.color = '#888';
    message.style.fontStyle = 'italic';
    message.textContent = 'Âπ≥Â±ÄÔºÅ ü§ù';
    return;
  } else {
    currentPlayer = currentPlayer==='X'?'O':'X';
    updateTurnUI();
    if (isVsAI && currentPlayer===aiPlayer && message.textContent==='') {
      setTimeout(aiMove, 500);
    }
  }
}

function aiMove() {
  if (!gameActive) return;
  if (firstMove) firstMove = false;
  const winMove = findBestMove(aiPlayer);
  if (winMove !== null) return handleMove(cells[winMove]);

  const blockMove = findBestMove(humanPlayer);
  if (blockMove !== null) return handleMove(cells[blockMove]);

  const empty = cells.map((c,i)=>c.textContent===''?i:null).filter(i=>i!==null);
  if (empty.length===0) return;
  const choice = empty[Math.floor(Math.random()*empty.length)];
  handleMove(cells[choice]);
}

function findBestMove(player) {
  const winPatterns = [[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];
  for (let p of winPatterns) {
    const [a,b,c] = p;
    const values = [cells[a].textContent, cells[b].textContent, cells[c].textContent];
    if (values.filter(v=>v===player).length===2 && values.includes('')) {
      return p[values.indexOf('')];
    }
  }
  return null;
}

function checkWin(player) {
  const winPatterns=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];
  for (let p of winPatterns) {
    if (p.every(i=>cells[i].textContent===player)) return p;
  }
  return null;
}

function highlightWin(p){ p.forEach(i=>cells[i].classList.add('win')); }

function disableBoard(){ cells.forEach(c=>c.disabled=true); }

function updateScores() {
  scoreXEl.textContent = scores.X>0 ? scores.X : '-';
  scoreOEl.textContent = scores.O>0 ? scores.O : '-';
}

function updateTurnUI() {
  scoreCards.forEach(c=>c.classList.remove('active'));
  if (gameActive) {
    const currentCard = document.querySelector(`.score-card[data-player="${currentPlayer}"]`);
    currentCard.classList.add('active');
    if (isVsAI) {
      if (!firstMove) statusMessage.textContent = `ÂΩìÂâçËΩÆÂà∞ ${currentPlayer}`;
    } else {
      statusMessage.textContent = `ÂΩìÂâçËΩÆÂà∞ ${currentPlayer}`;
    }
  }
}

resetBtn.addEventListener('click', createBoard);

modeBtn.addEventListener('click', ()=>{
  isVsAI = !isVsAI;
  modeBtn.textContent = isVsAI ? "Ê®°ÂºèÔºö‰∫∫Êú∫ÂØπÊàò" : "Ê®°ÂºèÔºöÂèå‰∫∫ÂØπÊàò";
  createBoard();
});

scoreCards.forEach(card=>{
  card.addEventListener('click', ()=>{
    if (!isVsAI) return;
    scoreCards.forEach(c=>c.classList.remove('active'));
    card.classList.add('active');
    if (card.dataset.player==='X') {
      humanPlayer = 'X'; aiPlayer='O';
    } else {
      humanPlayer = 'O'; aiPlayer='X';
    }
    createBoard();
  });
});

createBoard();
</script>
</body>
</html>
